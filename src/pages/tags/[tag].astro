---
// 标签详情页，展示某标签下所有文章
import MainLayout from '../../layouts/MainLayout.astro';
import BlogPostCard from '../../components/BlogPostCard.astro';
import { getAllTags, getPostsByTag } from '../../services/BlogService';
import type { FullBlogPostEntry } from '../../services/BlogService'; // 从 BlogService 导入 FullBlogPostEntry 类型

export async function getStaticPaths() {
  const tags = await getAllTags();
  // 只返回有效的 tag.slug，过滤掉空字符串和 undefined
  return tags
    .filter(tag => tag.slug && tag.slug.trim() !== '')
    .map(tag => ({
      params: { tag: tag.slug },
      props: { tagName: tag.name }
    }));
}

const { tagName } = Astro.props;
const posts: FullBlogPostEntry[] = await getPostsByTag(tagName);
---

<MainLayout title={`${tagName} - 标签 - 我的博客`}>
  <h1 class="text-3xl font-bold mb-4">{tagName}</h1>
  <p class="text-gray-600 dark:text-gray-400 mb-8">
    该标签共有 {posts.length} 篇文章
  </p>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {posts.map((post) => (
      <BlogPostCard post={post} />
    ))}
  </div>
  
  {posts.length === 0 && (
    <div class="text-center py-12">
      <p class="text-xl text-gray-600 dark:text-gray-400">该标签下暂无文章</p>
    </div>
  )}
  
</MainLayout>
