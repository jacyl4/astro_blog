---
// 标签详情页，展示某标签下所有文章
import MainLayout from '../../layouts/MainLayout.astro';
import BlogPostCard from '../../components/BlogPostCard.astro';
import { getAllTags, getPostsByTag } from '../../services/BlogService';
import type { BlogPost } from '../../interfaces/BlogPost';

export async function getStaticPaths() {
  const tags = await getAllTags();
  // 只返回有效的 tag.slug，过滤掉空字符串和 undefined
  return tags
    .filter(tag => tag.slug && tag.slug.trim() !== '')
    .map(tag => ({
      params: { tag: tag.slug },
      props: { tagName: tag.name }
    }));
}

const { tag } = Astro.params;
const { tagName } = Astro.props;

const posts = await getPostsByTag(tag);
---

<MainLayout title={`${tagName} - 标签 - 我的博客`}>
  <div>
    <div>
      <a href="/tags" class="text-sm text-blue-600 dark:text-blue-400 hover:underline mb-2 inline-block">
        &larr; 所有标签
      </a>
      <h1 class="text-3xl font-bold flex items-center gap-2">
        <span>标签:</span>
        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 p-2 rounded-lg">
          {tagName}
        </span>
        <span class="text-xl font-normal text-gray-500 dark:text-gray-400">
          ({posts.length} 篇文章)
        </span>
      </h1>
    </div>
    
    {posts.length > 0 ? (
      <div>
        {posts.map((post: BlogPost) => (
          <BlogPostCard post={post} />
        ))}
      </div>
    ) : (
      <div>
        <p class="text-xl text-gray-600 dark:text-gray-400">该标签下暂无文章</p>
      </div>
    )}
    <div>
      <a href="/" class="text-blue-600 dark:text-blue-400 hover:underline">&larr; 返回首页</a>
    </div>
  </div>
</MainLayout>