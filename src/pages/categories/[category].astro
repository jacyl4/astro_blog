---
// 分类详情页，展示某分类下所有文章
import MainLayout from '../../layouts/MainLayout.astro';
import BlogPostCard from '../../components/BlogPostCard.astro';
import { getAllCategories, getPostsByCategory } from '../../services/BlogService';
import type { FullBlogPostEntry } from '../../services/BlogService'; // 从 BlogService 导入 FullBlogPostEntry 类型

export async function getStaticPaths() {
  const categories = await getAllCategories();
  
  // 过滤掉无效的类别
  const validCategories = categories.filter(cat => cat.slug && cat.slug.trim() !== '');
  
  return validCategories.map((category) => ({
    params: { category: category.name }, // 使用原始分类名称作为路由参数
    props: { categoryName: category.name },
  }));
}

const { categoryName } = Astro.props;
const posts: FullBlogPostEntry[] = await getPostsByCategory(categoryName);
---

<MainLayout title={`${categoryName} - 分类 - 我的博客`}>
  <h1 class="text-3xl font-bold mb-4">{categoryName}</h1>
  <p class="text-gray-600 dark:text-gray-400 mb-8">
    该分类共有 {posts.length} 篇文章
  </p>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {posts.map((post) => (
      <BlogPostCard post={post} />
    ))}
  </div>
  
  {posts.length === 0 && (
    <div class="text-center py-12">
      <p class="text-xl text-gray-600 dark:text-gray-400">该分类下暂无文章</p>
    </div>
  )}
  
</MainLayout>
