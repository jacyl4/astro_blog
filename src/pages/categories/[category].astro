---
// Category detail page - displays all posts under a category
import MainLayout from '@/layouts/MainLayout.astro';
import BlogPostCard from '@/components/BlogPostCard.astro';
import { getAllCategories, getPostsByCategory, type ProcessedBlogPost } from '@/services/BlogService';
import { SITE_TITLE, UI_TEXT, PAGE_TITLES } from '@/consts';

export async function getStaticPaths() {
  const categories = await getAllCategories();
  
  // Filter out invalid categories
  const validCategories = categories.filter(cat => cat.slug && cat.slug.trim() !== '');
  
  return validCategories.map((category) => ({
    params: { category: category.slug },
    props: { categoryName: category.name },
  }));
}

const { categoryName } = Astro.props;
const posts: ProcessedBlogPost[] = await getPostsByCategory(categoryName);
---

<MainLayout title={`${categoryName} - ${PAGE_TITLES.categories} - ${SITE_TITLE}`}>
  <h1 class="text-3xl font-bold mb-4">{categoryName}</h1>
  <p class="mb-8" style="color: var(--meta-category-color);">
    {UI_TEXT.postsInCategory(posts.length)}
  </p>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {posts.map((post) => (
      <BlogPostCard post={post} />
    ))}
  </div>
  
  {posts.length === 0 && (
    <div class="text-center py-12">
      <p class="text-xl" style="color: var(--meta-label-color);">{UI_TEXT.noPostsInCategory}</p>
    </div>
  )}
  
</MainLayout>
